#include <Adafruit_LiquidCrystal.h>

// Inicializar la pantalla LCD con los pines correspondientes
Adafruit_LiquidCrystal lcd(12, 11, 5, 4, 3, 2);
int val=0;
int analogPin=0;
int signalPin = A0; // Pin de la señal del generador de funciones
int signalValue = 0; // Valor leído de la señal
float voltage = 0; // Voltaje calculado
int startButtonPin = 7; // Pin del pulsador de inicio
int stopButtonPin = 8;  // Pin del pulsador de parada
bool isReading = false; // Control de lectura

void setup() {
  // Inicializar la comunicación serie y la pantalla LCD
  Serial.begin(9600);
  lcd.begin(16, 2);
  lcd.print("Sistema listo");

  pinMode(startButtonPin, INPUT); // Configurar pulsador de inicio como entrada
  pinMode(stopButtonPin, INPUT);  // Configurar pulsador de parada como entrada
}

void loop() {
  
  val= analogRead(analogPin);
  Serial.println(val);
  // Verificar si el pulsador de inicio ha sido presionado
  if (digitalRead(startButtonPin) == HIGH && !isReading){
    isReading = true;  // Comenzar la lectura
    Serial.println("Iniciando lectura...");
    lcd.clear();
    lcd.setCursor(0, 0); // Establece el cursor en la posición (0,0)
    lcd.print("Iniciando lectura");
    
  }

  // Verificar si el pulsador de parada ha sido presionado
  if (digitalRead(stopButtonPin) == HIGH && isReading) {
    isReading = false;  // Detener la lectura
    Serial.println("Parando lectura...");
    lcd.clear();
    lcd.setCursor(0, 0); // Establece el cursor en la posición (0,0)
    lcd.print("Parando lectura");
    
  }

  // Si estamos en modo de lectura, capturar y enviar los valores
  if (isReading) {
    signalValue = analogRead(signalPin); // Leer la señal
    voltage = signalValue * (5.0 / 1023.0); // Convertir a voltios
    
    // Enviar el voltaje al Monitor Serial
    Serial.print("Voltaje: ");
    Serial.println(voltage);
    
    // Mostrar el voltaje en el LCD
    lcd.setCursor(0, 1); // Establece el cursor en la segunda línea
    lcd.print("Volt: ");
    lcd.print(voltage);
    lcd.print(" V");
    
  }
}